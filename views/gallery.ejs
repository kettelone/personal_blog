<!DOCTYPE html>
<html lang="en">

    <%- include('./partials/head.ejs')%>


<body>
   
    <%- include('./partials/nav.ejs')%>

    <% if(images.length > 0){%>
    <div class="gallery-container">
        <% images.forEach((image) =>{ %>
            <div class="image-wrapper">
                <img src="data:image/png;base64, <%= image.image.toString('base64') %>" class ="db-images">
                <button action="/delete-img" class="delete-img" data-id="<%= image.image_id %>">Delete</button>
            </div>
        <% }) %>
    </div>
        <% }else { %>
    
            <p style="text-align: center">Upload some of your photos here</p>
    
        <% } %>
    <div class="image-form-wrapper">
        <form action="/upload-image" method="POST" enctype="multipart/form-data" class="upload-image-form">
            <label for="img">Select image:</label>
            <input type="file" id="img" name="img" accept="image/*">
            <input type="submit">
          </form>
    </div>
    
    <%- include('./partials/footer.ejs')%>

    <script>
        const deleteImgButton = document.querySelectorAll('.delete-img');
        deleteImgButton.forEach((item) =>{
            item.addEventListener('click', (e) => {
            console.log(e.target)
            console.log(deleteImgButton)
            const imgID = e.target.dataset.id
            fetch(`/delete-image/${imgID}`, { 
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => window.location.href = data.redirect)
            .catch(err => console.log(err));
    })
        })
    </script>
</body>
</html>